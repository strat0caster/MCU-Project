C51 COMPILER V9.00   MPU2MCU_TEST                                                          12/30/2015 21:31:53 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MPU2MCU_TEST
OBJECT MODULE PLACED IN MPU2MCU_Test.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE MPU2MCU_Test.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #define D_Round 0.2  //定义
   2          #define pi 3.14159265358
   3          
   4          
   5          
   6          #include <lights.h>
   7          
   8          
   9          float wx,wy,wz,ax,ay,az;//raw data from MPU6050;quite likely that we won't use wy&ay though
  10          float Roll ,Pitch ,Yaw=0;
  11           unsigned char Rebuf[11],counter=0,test=0x55;
  12           unsigned char sign;
  13          
  14          
  15          void UartInit(void)             //115200bps@11.0592MHz
  16          {
  17   1              EA=1;
  18   1              ES=1;
  19   1              SCON = 0x50;            //8位数据,可变波特率
  20   1      //      AUXR &= 0xBF;           //定时器1时钟为Fosc/12,即12T
  21   1      //      AUXR &= 0xFE;           //串口1选择定时器1为波特率发生器
  22   1              TMOD &= 0x02;           //设定定时器1为16位自动重装方式
  23   1              TL1 = 0xFD;             //设定定时初值
  24   1              TH1 = 0xFD;             //设定定时初值
  25   1              ET1 = 0;                //禁止定时器1中断
  26   1              TR1 = 1;                //启动定时器1
  27   1              PCON = 0x00;
  28   1      }
  29          void main(){
  30   1              unsigned char LED;
  31   1      LED=0x22;
  32   1      P0=LED;//测试
  33   1      
  34   1      UartInit();
  35   1              while(1){
  36   2              if(Yaw>20){LED=0x55;}
  37   2              else{LED=0x88;}
  38   2              }
  39   1              P0=LED;
  40   1      }
  41          
  42          
  43          void ser() interrupt 4{ 
  44   1              P2=test;
  45   1              test++;
  46   1      if(RI){
  47   2              RI=0;
  48   2              Rebuf[counter]=SBUF;    
  49   2              SBUF=Rebuf[counter];
  50   2                      if(counter==0 && Rebuf[0]!=0x55) return;
  51   2                      counter++;
  52   2                      if(counter==11) {
  53   3                              counter=0;
  54   3                              switch(Rebuf [1]) {
  55   4                              case 0x51:
C51 COMPILER V9.00   MPU2MCU_TEST                                                          12/30/2015 21:31:53 PAGE 2   

  56   4                                      //检查帧头
  57   4                                      ax= ((Rebuf [3]<<8| Rebuf [2]))/32768.0*16; 
  58   4                                      ay= ((Rebuf [5]<<8| Rebuf [4]))/32768.0*16; 
  59   4                                      az= ((Rebuf [7]<<8| Rebuf [6]))/32768.0*16; 
  60   4                                      break;
  61   4                              case 0x52:
  62   4                                      wx = ((Rebuf [3]<<8| Rebuf [2]))/32768.0*2000;
  63   4                                      wy = ((Rebuf [5]<<8| Rebuf [4]))/32768.0*2000; 
  64   4                                      wz = ((Rebuf [7]<<8| Rebuf [6]))/32768.0*2000;
  65   4                                      break;
  66   4                              case 0x53: 
  67   4                                      Roll = ((Rebuf [3]<<8| Rebuf [2]))/32768.0*180; 
  68   4                                      Pitch = ((Rebuf [5]<<8| Rebuf [4]))/32768.0*180; 
  69   4                                      Yaw = ((Rebuf [7]<<8| Rebuf [6]))/32768.0*180; 
  70   4                                      break;
  71   4                              }
  72   3                      }
  73   2              }
  74   1      if(TI){TI=0;}
  75   1      }
  76          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    528    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     50       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
